---
layout: default
title: "类的内存结构和函数的特性"
date:   2024-04-30 14:16:27 +0800
categories: [update,CPP] 
---

在C++中，类的内存结构和函数的特性是编程中的核心概念。

<img src="image/virtualPointerAndVirtualTable.drawio.svg" style="float:left;zoom:100%">

### 类的内存结构

当你创建一个类的对象时，类的内存布局通常如下：

1. **成员变量**：对象在内存中首先包含其所有非静态成员变量。这些成员变量的内存布局通常按它们在类定义中出现的顺序排列，但编译器可能会进行优化以减少填充和对齐开销。

2. **继承**：在继承的情况下，派生类对象首先包含基类部分的布局，然后是派生类特有的成员变量。

3. **虚函数表（vtable）**：如果类有虚函数，每个对象通常还会有一个指向虚函数表（vtable）的指针。虚函数表是一个函数指针数组，用于支持动态多态性。这个指针通常位于对象的内存布局的开始处。

4. **静态成员变量**：静态成员变量不存储在对象的内存空间内。它们在程序的全局数据区域中有独立的存储空间，并被该类的所有对象共享。

### 类中的函数

类中的函数可以分为几类：

1. **普通成员函数**：这些函数可以访问类的所有成员（包括私有成员）。每个对象都可以调用这些函数，但它们操作的是调用它们的对象的成员变量。

2. **静态成员函数**：静态成员函数不与任何特定的对象相关联。它们不能直接访问类的非静态成员，但可以访问静态成员。

3. **虚函数**：虚函数允许在派生类中被重写，支持多态性。虚函数的调用是通过虚函数表（vtable）实现的。

4. **构造函数和析构函数**：这些是用于创建和销毁对象的特殊函数。构造函数初始化对象的成员，而析构函数清理任何需要清理的资源。

### 类函数和普通函数

- 类中的成员函数（包括虚函数）与普通函数的主要区别在于它们对类内部成员的访问权限。成员函数可以访问类的私有和保护成员，而普通函数则不能。

- 成员函数隐式地接收一个指向当前对象的指针（通常称为指针），这就是它们能够操作特定对象的成员变量的原因。

- 虽然从功能上讲，类中的成员函数可以视为普通函数，但它们在调用和访问权限方面与普通函数有所不同。

因此，虽然从某种程度上来说，类中的成员函数类似于普通函数，但它们是与特定对象关联的，且有访问类内部成员的特殊权限。
在C++中，类的内存结构和函数的特性是编程中的核心概念。

### 类的内存结构

当你创建一个类的对象时，类的内存布局通常如下：

1. **成员变量**：对象在内存中首先包含其所有非静态成员变量。这些成员变量的内存布局通常按它们在类定义中出现的顺序排列，但编译器可能会进行优化以减少填充和对齐开销。

2. **继承**：在继承的情况下，派生类对象首先包含基类部分的布局，然后是派生类特有的成员变量。

3. **虚函数表（vtable）**：如果类有虚函数，每个对象通常还会有一个指向虚函数表（vtable）的指针。虚函数表是一个函数指针数组，用于支持动态多态性。这个指针通常位于对象的内存布局的开始处。

4. **静态成员变量**：静态成员变量不存储在对象的内存空间内。它们在程序的全局数据区域中有独立的存储空间，并被该类的所有对象共享。

### 类中的函数

类中的函数可以分为几类：

1. **普通成员函数**：这些函数可以访问类的所有成员（包括私有成员）。每个对象都可以调用这些函数，但它们操作的是调用它们的对象的成员变量。

2. **静态成员函数**：静态成员函数不与任何特定的对象相关联。它们不能直接访问类的非静态成员，但可以访问静态成员。

3. **虚函数**：虚函数允许在派生类中被重写，支持多态性。虚函数的调用是通过虚函数表（vtable）实现的。

4. **构造函数和析构函数**：这些是用于创建和销毁对象的特殊函数。构造函数初始化对象的成员，而析构函数清理任何需要清理的资源。

### 类函数和普通函数

- 类中的成员函数（包括虚函数）与普通函数的主要区别在于它们对类内部成员的访问权限。成员函数可以访问类的私有和保护成员，而普通函数则不能。

- 成员函数隐式地接收一个指向当前对象的指针（通常称为指针），这就是它们能够操作特定对象的成员变量的原因。

- 虽然从功能上讲，类中的成员函数可以视为普通函数，但它们在调用和访问权限方面与普通函数有所不同。

因此，虽然从某种程度上来说，类中的成员函数类似于普通函数，但它们是与特定对象关联的，且有访问类内部成员的特殊权限。




